{{ 'header.css' | asset_url | stylesheet_tag }}
<script src="{{ 'my-mobile-menu.js' | asset_url }}" type='module' defer></script>

<sticky-header data-sticky-header="on-srcoll-up" class="header-wrapper gradient header-wrapper--border-bottom">
  <responsive-container class="header-container">
      <div class="header-menu__container">
        <ul class="menu">        
          {% for link in linklists.main-menu.links %}
            <li class="menu-link">
              <a href="{{ link.url }}">{{ link.title }}</a> 
              {%- if link.links.size > 0 -%}
                <ul class="menu dropdown-child">
                  {% for child_link in link.links %}
                    <li class="menu-link">
                      <a href="{{ child_link.url }}">{{ child_link.title }}</a>
                      
                      {%- if child_link.links.size > 0 -%}
                        <ul class="menu dropdown-grandChild">
                          {% for grandChild_link in child_link.links %}
                            <li class="menu-link">
                              <a href="{{ grandChild_link.url }}">{{ grandChild_link.title }}</a>
                            </li>
                          {% endfor %}
                        </ul>
                      {%- endif -%}
                    </li>
                  {% endfor %}
                </ul>
              {%- endif -%}
            </li>
          {% endfor %}
        </ul>

        <my-mobile-menu>
          <div class="mobile-menu">
            <img
              width="32"
              height="32" 
              src="{{ 'icon-menu.svg' | asset_url }}" 
              alt="icon-menu"
            />
            <div class="menu-drawer">
              <ul class="menu">
                {%- for link in linklists.main-menu.links -%}
                  <li class="menu-link">
                    <a href="{{ link.url }}">
                      {{ link.title }}
                    </a>
                    {%- if link.links.size > 0 -%}
                      {%- for child_link in link.links -%}
                        <li class="menu-link child">
                          <a href="{{ child_link.url }}">
                            {{ child_link.title }}
                          </a>
                          {%- if child_link.links.size > 0 -%}
                            {%- for grandChild_link in child_link.links -%}
                              <li class="menu-link grandChild">
                                <a href="{{ grandChild_link.url }}">
                                  {{ grandChild_link.title }}
                                </a>
                              </li>
                            {%- endfor -%}
                          {%- endif -%}
                        </li>
                      {%- endfor -%}
                    {%- endif -%}
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          </div>
        </my-mobile-menu>
      </div>

      
      <div class="header-logo__container">
        {%- if section.settings.logo_image %}
          {{  
            section.settings.logo_image |
            image_url: width: 48,height: 48 | 
            image_tag:
              alt: "logo",
              class:'header-logo__image',
              preload:true
          }}
          {%- else -%}
            <span class="heder-logo__text">{{ section.settings.logo_text }}</span>  
        {%- endif -%}
      </div>
      
        
      <div class="header-navigator__container">
        <div class="search-container">
          <form action="{{ routes.search_url }}" method="get" class="search-form">
            <input 
              type="text" 
              name="q" 
              class="search-input" 
              placeholder="Search..." 
              value="{{ search.terms | escape }}"
              autocomplete="off"
            />
            <button type="submit" class="search-btn">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </button>
          </form>
        </div>
        <div class="nav-icons">
          <!-- Wishlist/Heart Icon -->
          <a href="{{ routes.collections_url }}" class="nav-icon wishlist-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span class="nav-icon-count wishlist-count" style="display: none;">0</span>
          </a>

          <!-- User Account Icon -->
          <a href="{{ routes.account_url }}" class="nav-icon user-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>

          <!-- Shopping Cart Icon -->
          <a href="{{ routes.cart_url }}" class="nav-icon cart-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            {% if cart.item_count > 0 %}
              <span class="nav-icon-count cart-count">{{ cart.item_count }}</span>
            {% endif %}
          </a>
        </div>
      </div>
  </responsive-container>
</sticky-header>

{% javascript %}
  class StickyHeader extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      this.header = document.querySelector('.section-header');
      this.headerIsAlwaysSticky =
        this.getAttribute('data-sticky-type') === 'always' ||
        this.getAttribute('data-sticky-type') === 'reduce-logo-size';
      this.headerBounds = {};

      this.setHeaderHeight();

      window.matchMedia('(max-width: 990px)').addEventListener('change', this.setHeaderHeight.bind(this));

      if (this.headerIsAlwaysSticky) {
        this.header.classList.add('shopify-section-header-sticky');
      }

      this.currentScrollTop = 0;
      this.preventReveal = false;
      this.predictiveSearch = this.querySelector('predictive-search');

      this.onScrollHandler = this.onScroll.bind(this);
      this.hideHeaderOnScrollUp = () => (this.preventReveal = true);

      this.addEventListener('preventHeaderReveal', this.hideHeaderOnScrollUp);
      window.addEventListener('scroll', this.onScrollHandler, false);

      this.createObserver();
    }

    setHeaderHeight() {
      document.documentElement.style.setProperty('--header-height', `${this.header.offsetHeight}px`);
    }

    disconnectedCallback() {
      this.removeEventListener('preventHeaderReveal', this.hideHeaderOnScrollUp);
      window.removeEventListener('scroll', this.onScrollHandler);
    }

    createObserver() {
      let observer = new IntersectionObserver((entries, observer) => {
        this.headerBounds = entries[0].intersectionRect;
        observer.disconnect();
      });

      observer.observe(this.header);
    }

    onScroll() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (this.predictiveSearch && this.predictiveSearch.isOpen) return;
      
      if (scrollTop > this.currentScrollTop && scrollTop > this.headerBounds.bottom) {
        this.header.classList.add('scrolled-past-header');
        if (this.preventHide) return;

        requestAnimationFrame(this.hide.bind(this));
      } else if (scrollTop < this.currentScrollTop && scrollTop > this.headerBounds.bottom) {
        this.header.classList.add('scrolled-past-header');
        if (!this.preventReveal) {
          requestAnimationFrame(this.reveal.bind(this));
        } else {
          window.clearTimeout(this.isScrolling);

          this.isScrolling = setTimeout(() => {
            this.preventReveal = false;
          }, 66);

          requestAnimationFrame(this.hide.bind(this));
        }
      } else if (scrollTop <= this.headerBounds.top) {
        this.header.classList.remove('scrolled-past-header');
        requestAnimationFrame(this.reset.bind(this));
      }

      this.currentScrollTop = scrollTop;
    }

    hide() {
      if (this.headerIsAlwaysSticky) return;
      this.header.classList.add('shopify-section-header-hidden', 'shopify-section-header-sticky');
      this.closeMenuDisclosure();
      this.closeSearchModal();
    }

    reveal() {
      if (this.headerIsAlwaysSticky) return;
      this.header.classList.add('shopify-section-header-sticky', 'animate');
      this.header.classList.remove('shopify-section-header-hidden');
    }

    reset() {
      if (this.headerIsAlwaysSticky) return;
      this.header.classList.remove('shopify-section-header-hidden', 'shopify-section-header-sticky', 'animate');
    }

    closeMenuDisclosure() {
      this.disclosures = this.disclosures || this.header.querySelectorAll('header-menu');
      if(!this.disclosures) return;
      this.disclosures.forEach((disclosure) => disclosure.close());
    }

    closeSearchModal() {
      this.searchModal = this.searchModal || this.header.querySelector('details-modal');
      if(!this.searchModal) return;
      this.searchModal.close(false);
    }
  }

  customElements.define('sticky-header', StickyHeader);
{% endjavascript %}

{% schema %}
{
  "name": "t:sections.header.name",
  "tag": "section",
  "class": "section-header",
  "settings": [
    {
      "type": "text",
      "id": "logo_text",
      "label": "logo_text",
      "default":"LOGO"
    },
    {
      "type": "image_picker",
      "id": "logo_image",
      "label": "logo_image"
    },
  ]
}
{% endschema %}