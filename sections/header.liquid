{{ 'header.css' | asset_url | stylesheet_tag }}
<script src="{{ 'my-mobile-menu.js' | asset_url }}" type='module' defer></script>

<sticky-header data-sticky-header="on-srcoll-up" class="header-wrapper gradient header-wrapper--border-bottom">
  <responsive-container class="header-container">
      <div class="header-menu__container">
        {%- if section.settings.menu_type == 'default' -%}
          <nav class="desktop-nav">  
            {% for link in linklists.main-menu.links %}
              {%- assign has_submenu = false -%}
              {%- if link.links.size > 0 -%}
                {%- assign has_submenu = true -%}
              {%- endif -%}
              <div class="nav-item">
                <a href="{{ link.url }}" class="nav-link">
                  {{ link.title }}
                  {%- if has_submenu == true %}
                    {{- 'icon-nav-arrow.svg' | inline_asset_content -}}
                  {%- endif -%}
                </a>

                {% comment %} sendary-menu {% endcomment %}
                {%- if link.links.size > 0 -%}
                  <div class="submenu">
                    {%- for child_link in link.links -%}
                      {%- assign has_third = false -%}
                      {%- if child_link.links.size > 0 -%}
                        {%- assign has_third = true -%}
                      {%- endif -%}
                      <div class="submenu-item {% if has_third == true %} has-child {% endif %}">
                        <a href="{{ child_link.url }}" style="display:flex;justify-content:space-between;align-items: center;">
                          {{ child_link.title }}
                          {%- if has_third == true %}
                            <div class="arrow-right">
                              {{- 'icon-nav-arrow.svg' | inline_asset_content -}}
                            </div>
                          {%- endif -%}
                        </a>
                        {%- if has_third == true %}
                          {% comment %} third-menu {% endcomment %}
                          <div class="thirdmenu">
                            {%- for grandChild_link in child_link.links -%}
                              <div class="submenu-item">
                                <a href="{{ grandChild_link.url }}">{{ grandChild_link.title }}</a>
                              </div>
                            {%- endfor -%}
                          </div>
                        {%- endif -%}
                      </div>
                    {%- endfor -%}
                  </div> 
                {%- endif -%}
              </div>
            {% endfor %}
          </nav>
        {%- else -%}
          <nav class="desktop-supernav">
            {%- for link in linklists.main-menu.links -%}
              <div class="nav-item">
                <a href="{{ link.url }}" class="nav-link">
                  {{ link.title }}
                  {{- 'icon-nav-arrow.svg' | inline_asset_content -}}
                </a> 
              </div> 
            {%- endfor -%}
            <div class="supermenu">
              <div class="inner">
                <div class="supermenu-columns">
                  {%- for link in linklists.main-menu.links -%}
                    {%- for child_link in link.links -%}
                      {%- unless child_link == nil  -%}
                        <div class="supermenu-column">
                          <a href="{{ child_link.url }}">{{ child_link.title }}</a>

                          {%- for grand_link in child_link.links -%}
                            <a href="{{ grand_link.url }}">{{ grand_link.title }}</a>
                          {%- endfor -%}
                        </div>
                      {%- endunless -%}
                    {%- endfor -%}
                  {%- endfor -%}
                </div>
                <div class="supermenu-image">
                  {% for i in (1..3) %}
                    {% assign collection_key = "collection_" | append: i %}
                    {% assign collection = section.settings[collection_key] %}

                    {% if collection %}
                        <a href="{{ collection.url }}">
                          <responsive-container>
                            {{ 
                              collection.featured_image
                              | image_url: width: 200, height: 200
                              | image_tag:
                                  alt: collection.title
                            }}  
                          </responsive-container>                           
                          <span>{{ collection.title }}</span>
                        </a>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
            </div>
          </nav>
        {% endif %}

        <my-mobile-menu class="mobile-nav">
          <button class="mobile-menu-button">
            <img
              width="32"
              height="32" 
              src="{{ 'icon-menu.svg' | asset_url }}" 
              alt="icon-menu"
            />
          </button>

          {% comment %} mobile menu drawer {% endcomment %}
          <div id="mobile-menu" class="mobile-menu">
            {%- for link in linklists.main-menu.links -%}
              {%- assign has_sub = false -%}
              {%- if link.links.size > 0 -%}
                {%- assign has_sub = true -%}
              {%- endif -%}

              <div class="mobile-menu-item">
                {%- if has_sub -%}
                  <button class="mobile-menu-toggle">
                    {{ link.title }}    
                    {{ 'icon-nav-arrow.svg' | inline_asset_content }}
                  </button>
                {%- else -%}
                  <a href="{{ link.url }}" class="nav-link">
                    {{ link.title }}
                  </a>
                {%- endif -%}
                
                {% comment %} mobile menu second {% endcomment %}
               <div class="mobile-submenu">
                  {%- for child_link in link.links -%}
                    {%- assign has_third = false -%}
                    {%- if child_link.links.size > 0 -%}
                      {%- assign has_third = true -%}
                    {%- endif -%}

                    <div class="mobile-submenu-item">
                      {%- if has_third -%}
                        <button class="mobile-submenu-toggle">
                          {{ child_link.title }}
                          {{ 'icon-nav-arrow.svg' | inline_asset_content }}
                        </button>
                      {%- else -%}
                        <a href="{{ child_link.url }}">
                          {{ child_link.title }}
                        </a>  
                      {%- endif -%}

                      {% comment %} mobile menu third {% endcomment %}
                      <div class="mobile-thirdmenu"> 
                        {%- for grandChild_link in child_link.links -%}
                          <a href="{{ grandChild_link.url }}">{{ grandChild_link.title }}</a>
                        {%- endfor -%}
                      </div>
                    </div>
                  {%- endfor -%}
                </div>
              </div>
            {%- endfor -%}
          </div>
        </my-mobile-menu>
      </div>
 
      <a class="header-logo__container" href="{{ routes.root_url }}">
        {%- if section.settings.logo_image %}
          {{  
            section.settings.logo_image |
            image_url: width: 48,height: 48 | 
            image_tag:
              alt: "logo",
              class:'header-logo__image',
              preload:true
          }}
          {%- else -%}
            <span class="heder-logo__text">{{ section.settings.logo_text }}</span>  
        {%- endif -%}
      </a>

      <div class="header-navigator__container">
        <div class="search-container">
          <form action="{{ routes.search_url }}" method="get" class="search-form">
            <input 
              type="text" 
              name="q" 
              class="search-input" 
              placeholder="Search..." 
              value="{{ search.terms | escape }}"
              autocomplete="off"
            />
            <button type="submit" class="search-btn">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </button>
          </form>
        </div>
        <div class="nav-icons">
          <!-- User Account Icon -->
          <a href="{{ routes.account_url }}" class="nav-icon user-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>

          <!-- Shopping Cart Icon -->
          <a href="{{ routes.cart_url }}" class="nav-icon cart-icon" id="cart-icon-bubble">
            {% if cart == empty %}
              <span class="svg-wrapper">{{ 'icon-cart-empty.svg' | inline_asset_content }}</span>
            {% else %}
              <span class="svg-wrapper">{{ 'icon-cart.svg' | inline_asset_content }}</span>
            {% endif %}
            <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
            {%- if cart != empty -%}
              <div class="cart-count-bubble">
                {%- if cart.item_count < 100 -%}
                  <span aria-hidden="true">{{ cart.item_count }}</span>
                {%- endif -%}
                <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
              </div>
            {%- endif -%}
          </a>
        </div>
      </div>
  </responsive-container>
</sticky-header>

{% javascript %}
  class StickyHeader extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      this.header = document.querySelector('.section-header');
      this.headerIsAlwaysSticky =
        this.getAttribute('data-sticky-type') === 'always' ||
        this.getAttribute('data-sticky-type') === 'reduce-logo-size';
      this.headerBounds = {};

      this.setHeaderHeight();

      window.matchMedia('(max-width: 990px)').addEventListener('change', this.setHeaderHeight.bind(this));

      if (this.headerIsAlwaysSticky) {
        this.header.classList.add('shopify-section-header-sticky');
      }

      this.currentScrollTop = 0;
      this.preventReveal = false;
      this.predictiveSearch = this.querySelector('predictive-search');

      this.onScrollHandler = this.onScroll.bind(this);
      this.hideHeaderOnScrollUp = () => (this.preventReveal = true);

      this.addEventListener('preventHeaderReveal', this.hideHeaderOnScrollUp);
      window.addEventListener('scroll', this.onScrollHandler, false);

      this.createObserver();
    }

    setHeaderHeight() {
      document.documentElement.style.setProperty('--header-height', `${this.header.offsetHeight}px`);
    }

    disconnectedCallback() {
      this.removeEventListener('preventHeaderReveal', this.hideHeaderOnScrollUp);
      window.removeEventListener('scroll', this.onScrollHandler);
    }

    createObserver() {
      let observer = new IntersectionObserver((entries, observer) => {
        this.headerBounds = entries[0].intersectionRect;
        observer.disconnect();
      });

      observer.observe(this.header);
    }

    onScroll() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (this.predictiveSearch && this.predictiveSearch.isOpen) return;
      
      if (scrollTop > this.currentScrollTop && scrollTop > this.headerBounds.bottom) {
        this.header.classList.add('scrolled-past-header');
        if (this.preventHide) return;

        requestAnimationFrame(this.hide.bind(this));
      } else if (scrollTop < this.currentScrollTop && scrollTop > this.headerBounds.bottom) {
        this.header.classList.add('scrolled-past-header');
        if (!this.preventReveal) {
          requestAnimationFrame(this.reveal.bind(this));
        } else {
          window.clearTimeout(this.isScrolling);

          this.isScrolling = setTimeout(() => {
            this.preventReveal = false;
          }, 66);

          requestAnimationFrame(this.hide.bind(this));
        }
      } else if (scrollTop <= this.headerBounds.top) {
        this.header.classList.remove('scrolled-past-header');
        requestAnimationFrame(this.reset.bind(this));
      }

      this.currentScrollTop = scrollTop;
    }

    hide() {
      if (this.headerIsAlwaysSticky) return;
      this.header.classList.add('shopify-section-header-hidden', 'shopify-section-header-sticky');
      this.closeMenuDisclosure();
      this.closeSearchModal();
    }

    reveal() {
      if (this.headerIsAlwaysSticky) return;
      this.header.classList.add('shopify-section-header-sticky', 'animate');
      this.header.classList.remove('shopify-section-header-hidden');
    }

    reset() {
      if (this.headerIsAlwaysSticky) return;
      this.header.classList.remove('shopify-section-header-hidden', 'shopify-section-header-sticky', 'animate');
    }

    closeMenuDisclosure() {
      this.disclosures = this.disclosures || this.header.querySelectorAll('header-menu');
      if(!this.disclosures) return;
      this.disclosures.forEach((disclosure) => disclosure.close());
    }

    closeSearchModal() {
      this.searchModal = this.searchModal || this.header.querySelector('details-modal');
      if(!this.searchModal) return;
      this.searchModal.close(false);
    }
  }

  customElements.define('sticky-header', StickyHeader);
{% endjavascript %}

{% schema %}
{
  "name": "t:sections.header.name",
  "tag": "section",
  "class": "section-header",
  "settings": [
    {
      "type": "select",
      "id": "menu_type",
      "label": "Menu Type",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "super_menu",
          "label": "Super Menu"
        }
      ],
      "info":"Only type is supermenu,you can setting the collection"
    },
    {
      "type": "collection",
      "id": "collection_1",
      "label": "Collection1"
    },
    {
      "type": "collection",
      "id": "collection_2",
      "label": "Collection2"
    },
    {
      "type": "collection",
      "id": "collection_3",
      "label": "Collection3"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "logo_text",
      "default":"LOGO"
    },
    {
      "type": "image_picker",
      "id": "logo_image",
      "label": "logo_image"
    },
  ]
}
{% endschema %}